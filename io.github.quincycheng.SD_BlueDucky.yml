id: io.github.quincycheng.SD_BlueDucky
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: run.sh
finish-args:
  - --share=network
  - --device=all
  - --allow=bluetooth
  - --system-talk-name=org.bluez
  - --env=DBUS_FATAL_WARNINGS=0
  - --filesystem=host

modules:
  - name: run
    buildsystem: simple
    build-commands:
      - install -D run.sh /app/bin/run.sh
    sources:
      - type: file
        path: run.sh

        
  - name: ical
    cleanup: 
      - /lib/cmake
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_INSTALL_LIBDIR=/app/lib
      - -DBUILD_SHARED_LIBS=ON
    sources: 
      - type: archive
        url: https://github.com/libical/libical/archive/v3.0.10.tar.gz
        sha256: f933b3e6cf9d56a35bb5625e8e4a9c3a50239a85aea05ed842932c1a1dc336b4

  - name: bluez
    config-opts:
        - --disable-datafiles
        - --disable-systemd
        - --disable-manpages
        - --enable-library
        - --prefix=/app
        - --sysconfdir=/app/etc
        - --disable-udev
    sources:
      - type: archive
        url: https://mirrors.edge.kernel.org/pub/linux/bluetooth/bluez-5.69.tar.xz
        sha256: bc5a35ddc7c72d0d3999a0d7b2175c8b7d57ab670774f8b5b4900ff38a2627fc

  - name: pybluez
    buildsystem: simple
    build-commands:
      -  "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"${PWD}\" --no-build-isolation"
    sources:
      - type: git
        url: https://github.com/pybluez/pybluez.git
        
  - name: bdaddr
    buildsystem: simple
    build-commands:
      - gcc -o bdaddr tools/bdaddr.c src/oui.c -I . -lbluetooth
      - install -D bdaddr /app/bin/bdaddr
    sources:
      - type: git
        url: https://github.com/bluez/bluez.git


  - name: blueducky
    buildsystem: simple
    build-commands:
      -  install -D BlueDucky.py /app/BlueDucky.py
      -  install -D utils/magic_keyboard_hid.py /app/utils/magic_keyboard_hid.py
      -  install -D utils/menu_functions.py /app/utils/menu_functions.py
      -  install -D utils/register_device.py /app/utils/register_device.py
    sources:
      - type: git
        url: https://github.com/pentestfunctions/BlueDucky.git
        branch: main
