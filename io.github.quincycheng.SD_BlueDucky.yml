id: io.github.quincycheng.SD_BlueDucky
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: run.sh
finish-args:
  - --share=network
  - --device=all
  - --allow=bluetooth
  - --system-talk-name=org.bluez
  - --env=DBUS_FATAL_WARNINGS=0
  - --filesystem=host

modules:
  - name: run
    buildsystem: simple
    build-commands:
      - install -D run.sh /app/bin/run.sh
    sources:
      - type: file
        path: run.sh

        
  - name: ical
    cleanup: 
      - /lib/cmake
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_INSTALL_LIBDIR=/app/lib
      - -DBUILD_SHARED_LIBS=ON
    sources: 
      - type: archive
        url: https://github.com/libical/libical/archive/v3.0.10.tar.gz
        sha256: f933b3e6cf9d56a35bb5625e8e4a9c3a50239a85aea05ed842932c1a1dc336b4

  - name: bluez
    config-opts:
        - --disable-datafiles
        - --disable-systemd
        - --disable-manpages
        - --enable-library
        - --prefix=/app
        - --sysconfdir=/app/etc
        - --disable-udev
    sources:
      - type: archive
        url: https://mirrors.edge.kernel.org/pub/linux/bluetooth/bluez-5.69.tar.xz
        sha256: bc5a35ddc7c72d0d3999a0d7b2175c8b7d57ab670774f8b5b4900ff38a2627fc

  - name: pybluez
    buildsystem: simple
    build-commands:
      -  "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"${PWD}\" --no-build-isolation"
    sources:
      - type: git
        url: https://github.com/pybluez/pybluez.git
        
  - name: bdaddr
    buildsystem: simple
    build-commands:
      - gcc -o bdaddr tools/bdaddr.c src/oui.c -I . -lbluetooth
      - install -D bdaddr /app/bin/bdaddr
    sources:
      - type: git
        url: https://github.com/bluez/bluez.git


  - name: blueducky
    buildsystem: simple
    build-commands:
      -  install -D BlueDucky.py /app/BlueDucky.py
      -  install -D utils/magic_keyboard_hid.py /app/utils/magic_keyboard_hid.py
      -  install -D utils/menu_functions.py /app/utils/menu_functions.py
      -  install -D utils/register_device.py /app/utils/register_device.py
    sources:
      - type: git
        url: https://github.com/pentestfunctions/BlueDucky.git
        branch: main

  - name: pydbus
    buildsystem: simple
    build-commands:
      - python3 ./setup.py install --prefix=/app --root=/
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/58/56/3e84f2c1f2e39b9ea132460183f123af41e3b9c8befe222a35636baa6a5a/pydbus-0.6.0.tar.gz
        sha256: 4207162eff54223822c185da06c1ba8a34137a9602f3da5a528eedf3f78d0f2c


        
  - name: python3-pygobject
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pygobject" --no-build-isolation
    sources:
      - &id001
        type: file
        url: https://files.pythonhosted.org/packages/1c/41/91955188e97c7b85fbaac6bbf4e33de028899e0aa31bdce99b1afe2eeb17/pycairo-1.26.0.tar.gz
        sha256: 2dddd0a874fbddb21e14acd9b955881ee1dc6e63b9c549a192d613a907f9cbeb
        x-checker-data:
          name: pycairo
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/f9/9e/6bab1ed3bd878f0912d9a0600c21f3d88bab0e8a8d4c3ce50f5cf336faaf/pygobject-3.48.2.tar.gz
        sha256: c3c0a7afbe5b2c1c64dc0530109b4dd571085153dbedfbccb8ec7c5ad233f977
        x-checker-data:
          name: pygobject
          type: pypi
  - name: python3-pycairo
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pycairo" --no-build-isolation
    sources:
      - *id001
